# AI æŒ‡ä»¤æ€»åˆ™

## ğŸ“‹ æ–‡æ¡£ç›®çš„

æœ¬æ–‡æ¡£å®šä¹‰äº† AI åŠ©æ‰‹å¦‚ä½•ä¸å¼€å‘è€…åä½œï¼Œä»¥åŠé¡¹ç›®çš„ä»£ç é£æ ¼åå¥½ã€æ¶æ„åŸåˆ™å’Œå¼€å‘è§„èŒƒã€‚

## ğŸ¯ æ ¸å¿ƒåŸåˆ™

### 1. æ¶æ„æ¨¡å¼
- **ä¸¥æ ¼éµå¾ª MVI æ¶æ„**ï¼šå•å‘æ•°æ®æµï¼ŒIntent â†’ ViewModel â†’ State â†’ View
- **å•ä¸€æ•°æ®æº**ï¼šæ‰€æœ‰çŠ¶æ€é€šè¿‡ StateFlow ç®¡ç†ï¼Œé¿å…å¤šæ•°æ®æºå†²çª
- **ä¸å¯å˜çŠ¶æ€**ï¼šState ä½¿ç”¨ sealed classï¼Œç¡®ä¿çŠ¶æ€ä¸å¯å˜

### 2. ä»£ç é£æ ¼

#### Kotlin ç¼–ç è§„èŒƒ
- ä½¿ç”¨ **Kotlin å®˜æ–¹ç¼–ç è§„èŒƒ**ï¼ˆ[å®˜æ–¹æ–‡æ¡£](https://kotlinlang.org/docs/coding-conventions.html)ï¼‰
- ä¼˜å…ˆä½¿ç”¨ **è¡¨è¾¾å¼å‡½æ•°ä½“**ï¼š`fun isEmpty() = list.isEmpty()`
- ä¼˜å…ˆä½¿ç”¨ **æ•°æ®ç±»**ï¼š`data class User(val id: String, val name: String)`
- ä½¿ç”¨ **sealed class** è¡¨ç¤ºæœ‰é™çš„çŠ¶æ€é›†åˆ
- ä½¿ç”¨ **object** è¡¨ç¤ºå•ä¾‹æˆ–æ— çŠ¶æ€çš„ Intent

#### å‘½åè§„èŒƒ
```kotlin
// âœ… æ­£ç¡®ï¼šIntent ä½¿ç”¨åŠ¨è¯å¼€å¤´
sealed class UserIntent : MviIntent {
    data object LoadUsers : UserIntent()
    data class DeleteUser(val userId: String) : UserIntent()
    data class SearchUser(val keyword: String) : UserIntent()
}

// âœ… æ­£ç¡®ï¼šViewModel ä»¥ ViewModel ç»“å°¾
class UserListViewModel : MviViewModel<UserIntent>()

// âœ… æ­£ç¡®ï¼šStateFlow ä½¿ç”¨ _ å‰ç¼€è¡¨ç¤ºç§æœ‰å¯å˜ï¼Œå…¬å¼€åªè¯»
private val _userState = MutableStateFlow<UiState<List<User>>>(UiState.Idle)
val userState: StateFlow<UiState<List<User>>> = _userState.asStateFlow()

// âœ… æ­£ç¡®ï¼šAPI æ¥å£ä½¿ç”¨åè¯
interface UserApi {
    suspend fun getUserList(): ApiResponse<List<User>>
}
```

#### ä»£ç ç»„ç»‡
```kotlin
// âœ… æ­£ç¡®ï¼šæŒ‰åŠŸèƒ½åˆ†ç»„ï¼Œä½¿ç”¨æ³¨é‡Šåˆ†éš”
class UserViewModel : MviViewModel<UserIntent>() {
    
    // ========== State ==========
    private val _userState = MutableStateFlow<UiState<List<User>>>(UiState.Idle)
    val userState: StateFlow<UiState<List<User>>> = _userState.asStateFlow()
    
    // ========== Intent Handler ==========
    override fun handleIntent(intent: UserIntent) {
        when (intent) {
            is UserIntent.LoadUsers -> loadUsers()
            is UserIntent.DeleteUser -> deleteUser(intent.userId)
        }
    }
    
    // ========== Private Methods ==========
    private fun loadUsers() { ... }
    private fun deleteUser(userId: String) { ... }
}
```

### 3. ä¾èµ–ç®¡ç†

#### ç‰ˆæœ¬ç»Ÿä¸€
- æ‰€æœ‰ä¾èµ–ç‰ˆæœ¬åœ¨ `config.gradle` ä¸­ç»Ÿä¸€ç®¡ç†
- ä½¿ç”¨ **BOM (Bill of Materials)** ç®¡ç†ç›¸å…³åº“ç‰ˆæœ¬å¯¹é½
- ç¦æ­¢åœ¨æ¨¡å—çš„ `build.gradle` ä¸­ç¡¬ç¼–ç ç‰ˆæœ¬å·

#### ä¾èµ–ç±»å‹
```gradle
// âœ… æ­£ç¡®ï¼šä½¿ç”¨ api æš´éœ²ç»™ä¾èµ–æ¨¡å—
api rootProject.ext.deps["retrofit"]

// âœ… æ­£ç¡®ï¼šä½¿ç”¨ implementation éšè—å®ç°ç»†èŠ‚
implementation rootProject.ext.deps["glide"]

// âœ… æ­£ç¡®ï¼šdebug ä¸“ç”¨ä¾èµ–
debugApi rootProject.ext.deps["Di-dokit"]
```

### 4. é”™è¯¯å¤„ç†

#### ç»Ÿä¸€å¼‚å¸¸å¤„ç†
```kotlin
// âœ… æ­£ç¡®ï¼šä½¿ç”¨ ExceptionHandle ç»Ÿä¸€å¤„ç†
try {
    val response = apiService.getUserList()
    // å¤„ç†æˆåŠŸå“åº”
} catch (e: Exception) {
    val errorData = e.handleException()
    showToast(errorData.message)
    _userState.value = UiState.Error(errorData.message, e)
}
```

#### ç½‘ç»œè¯·æ±‚é”™è¯¯å¤„ç†
```kotlin
// âœ… æ­£ç¡®ï¼šä½¿ç”¨ launchRequest è‡ªåŠ¨å¤„ç†é”™è¯¯
launchRequest(_userState) {
    apiService.getUserList()
}

// âœ… æ­£ç¡®ï¼šè‡ªå®šä¹‰é”™è¯¯å¤„ç†
launchRequest(
    stateFlow = _userState,
    showLoading = true,
    request = { apiService.getUserList() }
) {
    // è‡ªåŠ¨å¤„ç† Loadingã€Successã€Error çŠ¶æ€
}
```

### 5. çŠ¶æ€ç®¡ç†

#### StateFlow ä½¿ç”¨è§„èŒƒ
```kotlin
// âœ… æ­£ç¡®ï¼šæ¯ä¸ªé¡µé¢ç»´æŠ¤ç‹¬ç«‹çš„çŠ¶æ€
private val _userState = MutableStateFlow<UiState<List<User>>>(UiState.Idle)
val userState: StateFlow<UiState<List<User>>> = _userState.asStateFlow()

// âŒ é”™è¯¯ï¼šä¸è¦åœ¨ View å±‚ç›´æ¥ä¿®æ”¹çŠ¶æ€
// binding.btnLoad.setOnClickListener {
//     _userState.value = UiState.Loading() // âŒ ç¦æ­¢
// }

// âœ… æ­£ç¡®ï¼šé€šè¿‡ Intent è§¦å‘çŠ¶æ€å˜æ›´
binding.btnLoad.setOnClickListener {
    sendIntent(UserIntent.LoadUsers) // âœ… æ­£ç¡®
}
```

#### UiState ä½¿ç”¨è§„èŒƒ
```kotlin
// âœ… æ­£ç¡®ï¼šä½¿ç”¨ sealed class è¡¨ç¤ºçŠ¶æ€
when (state) {
    is UiState.Idle -> { /* åˆå§‹çŠ¶æ€ */ }
    is UiState.Loading -> showLoading()
    is UiState.Success -> showData(state.data)
    is UiState.Error -> showError(state.message)
    is UiState.Empty -> showEmpty()
    is UiState.NetworkError -> showNetworkError()
}
```

### 6. åç¨‹ä½¿ç”¨è§„èŒƒ

#### ä½œç”¨åŸŸç®¡ç†
```kotlin
// âœ… æ­£ç¡®ï¼šä½¿ç”¨ viewModelScope
viewModelScope.launch {
    // ç½‘ç»œè¯·æ±‚
}

// âœ… æ­£ç¡®ï¼šä½¿ç”¨ launchIO åˆ‡æ¢åˆ° IO çº¿ç¨‹
launchIO {
    val data = apiService.getUserList()
    // åˆ‡æ¢åˆ°ä¸»çº¿ç¨‹æ›´æ–° UI
    launchMain {
        _userState.value = UiState.Success(data)
    }
}

// âŒ é”™è¯¯ï¼šä¸è¦ä½¿ç”¨ GlobalScope
GlobalScope.launch { ... } // âŒ ç¦æ­¢
```

#### Dispatcher åˆ‡æ¢
```kotlin
// âœ… æ­£ç¡®ï¼šç½‘ç»œè¯·æ±‚åœ¨ IO çº¿ç¨‹
withContext(Dispatchers.IO) {
    apiService.getUserList()
}

// âœ… æ­£ç¡®ï¼šUI æ›´æ–°åœ¨ä¸»çº¿ç¨‹
withContext(Dispatchers.Main) {
    _userState.value = UiState.Success(data)
}
```

### 7. ViewBinding ä½¿ç”¨è§„èŒƒ

```kotlin
// âœ… æ­£ç¡®ï¼šåœ¨ Activity ä¸­ä½¿ç”¨
class UserListActivity : MviActivity<ActivityUserListBinding, UserViewModel, UserIntent>() {
    override fun createBinding() = ActivityUserListBinding.inflate(layoutInflater)
    
    override fun initView() {
        binding.btnLoad.setOnClickListener {
            sendIntent(UserIntent.LoadUsers)
        }
    }
}
```

## ğŸš« ç¦æ­¢äº‹é¡¹

### 1. æ¶æ„è¿è§„
- âŒ **ç¦æ­¢**åœ¨ View å±‚ç›´æ¥ä¿®æ”¹ State
- âŒ **ç¦æ­¢**åœ¨ ViewModel ä¸­æŒæœ‰ Activity/Fragment å¼•ç”¨
- âŒ **ç¦æ­¢**ä½¿ç”¨ LiveDataï¼ˆç»Ÿä¸€ä½¿ç”¨ StateFlowï¼‰
- âŒ **ç¦æ­¢**ä½¿ç”¨ SharedFlow ç®¡ç†çŠ¶æ€ï¼ˆä½¿ç”¨ StateFlowï¼‰

### 2. ä»£ç è´¨é‡
- âŒ **ç¦æ­¢**ä½¿ç”¨ `!!` å¼ºåˆ¶è§£åŒ…ï¼ˆä½¿ç”¨ `?.` æˆ– `requireNotNull()`ï¼‰
- âŒ **ç¦æ­¢**ä½¿ç”¨ `var` å®šä¹‰å¯å˜å±æ€§ï¼ˆä¼˜å…ˆä½¿ç”¨ `val`ï¼‰
- âŒ **ç¦æ­¢**ä½¿ç”¨ `Any` ç±»å‹ï¼ˆä½¿ç”¨å…·ä½“ç±»å‹æˆ–æ³›å‹ï¼‰
- âŒ **ç¦æ­¢**ä½¿ç”¨ `printStackTrace()`ï¼ˆä½¿ç”¨æ—¥å¿—æ¡†æ¶ï¼‰

### 3. æ€§èƒ½é—®é¢˜
- âŒ **ç¦æ­¢**åœ¨ `collect` ä¸­æ‰§è¡Œè€—æ—¶æ“ä½œ
- âŒ **ç¦æ­¢**åœ¨ä¸»çº¿ç¨‹æ‰§è¡Œç½‘ç»œè¯·æ±‚
- âŒ **ç¦æ­¢**åˆ›å»ºä¸å¿…è¦çš„åç¨‹ä½œç”¨åŸŸ

## âœ… AI åä½œæŒ‡å—

### å½“ AI ç”Ÿæˆä»£ç æ—¶ï¼Œå¿…é¡»éµå¾ªï¼š

1. **æ¶æ„ä¸€è‡´æ€§**ï¼šç”Ÿæˆçš„ä»£ç å¿…é¡»ç¬¦åˆ MVI æ¶æ„æ¨¡å¼
2. **ç±»å‹å®‰å…¨**ï¼šä½¿ç”¨å®Œæ•´çš„ç±»å‹å®šä¹‰ï¼Œé¿å…ä½¿ç”¨ `Any`
3. **é”™è¯¯å¤„ç†**ï¼šæ‰€æœ‰ç½‘ç»œè¯·æ±‚å¿…é¡»åŒ…å«é”™è¯¯å¤„ç†
4. **ç”Ÿå‘½å‘¨æœŸå®‰å…¨**ï¼šä½¿ç”¨ `repeatOnLifecycle` æ”¶é›† Flow
5. **ä»£ç é£æ ¼**ï¼šéµå¾ªé¡¹ç›®æ—¢å®šçš„ä»£ç é£æ ¼å’Œå‘½åè§„èŒƒ

### ä»£ç å®¡æŸ¥æ£€æŸ¥æ¸…å•

AI ç”Ÿæˆçš„ä»£ç å¿…é¡»é€šè¿‡ä»¥ä¸‹æ£€æŸ¥ï¼š

- [ ] æ˜¯å¦éµå¾ª MVI æ¶æ„æ¨¡å¼ï¼Ÿ
- [ ] æ˜¯å¦ä½¿ç”¨ StateFlow ç®¡ç†çŠ¶æ€ï¼Ÿ
- [ ] æ˜¯å¦ä½¿ç”¨ sealed class å®šä¹‰ Intent å’Œ Stateï¼Ÿ
- [ ] æ˜¯å¦åŒ…å«å®Œæ•´çš„é”™è¯¯å¤„ç†ï¼Ÿ
- [ ] æ˜¯å¦ä½¿ç”¨æ­£ç¡®çš„åç¨‹ä½œç”¨åŸŸï¼Ÿ
- [ ] æ˜¯å¦éµå¾ªå‘½åè§„èŒƒï¼Ÿ
- [ ] æ˜¯å¦åŒ…å«å¿…è¦çš„æ³¨é‡Šï¼Ÿ

## ğŸ“š å‚è€ƒèµ„æº

- [Kotlin ç¼–ç è§„èŒƒ](https://kotlinlang.org/docs/coding-conventions.html)
- [Android æ¶æ„æŒ‡å—](https://developer.android.com/topic/architecture)
- [åç¨‹æœ€ä½³å®è·µ](https://kotlinlang.org/docs/coroutines-guide.html)
- [é¡¹ç›® README](../README.md)
- [æ¶æ„è®¾è®¡æ–‡æ¡£](../ARCHITECTURE.md)

---

**æœ€åæ›´æ–°**: 2024-12-17  
**ç»´æŠ¤è€…**: aFramework Team
