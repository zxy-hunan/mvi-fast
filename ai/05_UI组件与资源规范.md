# UI ç»„ä»¶ä¸èµ„æºè§„èŒƒ

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£å®šä¹‰äº† UI ç»„ä»¶ä½¿ç”¨ã€é¢œè‰²å­—ä½“è§„èŒƒã€å¤šè¯­è¨€æ”¯æŒå’Œé€šç”¨ Widget çš„ä½¿ç”¨è§„èŒƒã€‚

## ğŸ¨ é¢œè‰²è§„èŒƒ

### 1. é¢œè‰²å®šä¹‰

#### é¢œè‰²èµ„æºæ–‡ä»¶
```xml
<!-- res/values/colors.xml -->
<resources>
    <!-- åŸºç¡€é¢œè‰² -->
    <color name="white">#FFFFFFFF</color>
    <color name="black">#FF000000</color>
    
    <!-- ä¸»é¢˜é¢œè‰² -->
    <color name="primary">#FF6200EE</color>
    <color name="primary_dark">#FF3700B3</color>
    <color name="accent">#FF03DAC5</color>
    
    <!-- æ–‡æœ¬é¢œè‰² -->
    <color name="text_primary">#FF212121</color>
    <color name="text_secondary">#FF757575</color>
    <color name="text_hint">#FFBDBDBD</color>
    
    <!-- èƒŒæ™¯é¢œè‰² -->
    <color name="background">#FFF5F5F5</color>
    <color name="surface">#FFFFFFFF</color>
    
    <!-- çŠ¶æ€é¢œè‰² -->
    <color name="error">#FFB00020</color>
    <color name="success">#FF4CAF50</color>
    <color name="warning">#FFFF9800</color>
</resources>
```

#### ä½¿ç”¨è§„èŒƒ
```kotlin
// âœ… æ­£ç¡®ï¼šä½¿ç”¨èµ„æºé¢œè‰²
binding.textView.setTextColor(ContextCompat.getColor(context, R.color.text_primary))

// âœ… æ­£ç¡®ï¼šåœ¨ XML ä¸­ä½¿ç”¨
<TextView
    android:textColor="@color/text_primary"
    android:background="@color/surface" />

// âŒ é”™è¯¯ï¼šç¡¬ç¼–ç é¢œè‰²å€¼
binding.textView.setTextColor(0xFF212121.toInt())  // âŒ ç¦æ­¢
```

### 2. é¢œè‰²å‘½åè§„èŒƒ

- âœ… **åŸºç¡€é¢œè‰²**ï¼š`white`ã€`black`ã€`transparent`
- âœ… **ä¸»é¢˜é¢œè‰²**ï¼š`primary`ã€`primary_dark`ã€`accent`
- âœ… **æ–‡æœ¬é¢œè‰²**ï¼š`text_primary`ã€`text_secondary`ã€`text_hint`
- âœ… **èƒŒæ™¯é¢œè‰²**ï¼š`background`ã€`surface`ã€`divider`
- âœ… **çŠ¶æ€é¢œè‰²**ï¼š`error`ã€`success`ã€`warning`ã€`info`

## ğŸ“ å­—ä½“è§„èŒƒ

### 1. å­—ä½“å¤§å°

#### å­—ä½“å¤§å°å®šä¹‰
```xml
<!-- res/values/dimens.xml -->
<resources>
    <!-- å­—ä½“å¤§å° -->
    <dimen name="text_size_large">18sp</dimen>
    <dimen name="text_size_medium">16sp</dimen>
    <dimen name="text_size_normal">14sp</dimen>
    <dimen name="text_size_small">12sp</dimen>
    <dimen name="text_size_tiny">10sp</dimen>
</resources>
```

#### ä½¿ç”¨è§„èŒƒ
```xml
<!-- âœ… æ­£ç¡®ï¼šä½¿ç”¨èµ„æºå­—ä½“å¤§å° -->
<TextView
    android:textSize="@dimen/text_size_normal"
    android:text="Hello World" />

<!-- âŒ é”™è¯¯ï¼šç¡¬ç¼–ç å­—ä½“å¤§å° -->
<TextView
    android:textSize="14sp" />  <!-- âŒ ç¦æ­¢ -->
```

### 2. å­—ä½“æ ·å¼

#### å­—ä½“æ ·å¼å®šä¹‰
```xml
<!-- res/values/styles.xml -->
<style name="TextAppearance.Headline">
    <item name="android:textSize">@dimen/text_size_large</item>
    <item name="android:textStyle">bold</item>
    <item name="android:textColor">@color/text_primary</item>
</style>

<style name="TextAppearance.Body">
    <item name="android:textSize">@dimen/text_size_normal</item>
    <item name="android:textStyle">normal</item>
    <item name="android:textColor">@color/text_primary</item>
</style>
```

## ğŸŒ å¤šè¯­è¨€æ”¯æŒ

### 1. å­—ç¬¦ä¸²èµ„æº

#### å­—ç¬¦ä¸²å®šä¹‰
```xml
<!-- res/values/strings.xml (é»˜è®¤è‹±æ–‡) -->
<resources>
    <string name="app_name">My App</string>
    <string name="welcome_message">Welcome, %1$s!</string>
    <string name="button_confirm">Confirm</string>
    <string name="button_cancel">Cancel</string>
</resources>

<!-- res/values-zh/strings.xml (ä¸­æ–‡) -->
<resources>
    <string name="app_name">æˆ‘çš„åº”ç”¨</string>
    <string name="welcome_message">æ¬¢è¿ï¼Œ%1$sï¼</string>
    <string name="button_confirm">ç¡®è®¤</string>
    <string name="button_cancel">å–æ¶ˆ</string>
</resources>
```

#### ä½¿ç”¨è§„èŒƒ
```kotlin
// âœ… æ­£ç¡®ï¼šä½¿ç”¨å­—ç¬¦ä¸²èµ„æº
binding.textView.text = getString(R.string.welcome_message, userName)

// âœ… æ­£ç¡®ï¼šå¸¦å‚æ•°çš„å­—ç¬¦ä¸²
val message = getString(R.string.welcome_message, "John")

// âŒ é”™è¯¯ï¼šç¡¬ç¼–ç å­—ç¬¦ä¸²
binding.textView.text = "Welcome"  // âŒ ç¦æ­¢
```

### 2. å­—ç¬¦ä¸²å‘½åè§„èŒƒ

- âœ… **æŒ‰é’®æ–‡æœ¬**ï¼š`button_confirm`ã€`button_cancel`ã€`button_save`
- âœ… **æ ‡é¢˜æ–‡æœ¬**ï¼š`title_user_list`ã€`title_settings`
- âœ… **æç¤ºæ–‡æœ¬**ï¼š`hint_username`ã€`hint_password`
- âœ… **é”™è¯¯æ¶ˆæ¯**ï¼š`error_network`ã€`error_invalid_input`
- âœ… **ç©ºçŠ¶æ€**ï¼š`empty_state_no_data`ã€`empty_state_load_failed`

## ğŸ§© é€šç”¨ UI ç»„ä»¶

### 1. MviUiActivity

#### åŸºç¡€ä½¿ç”¨
```kotlin
/**
 * MviUiActivity æä¾›è‡ªåŠ¨çš„ç©ºçŠ¶æ€å’Œé”™è¯¯çŠ¶æ€ç®¡ç†
 */
class UserListActivity : MviUiActivity<ActivityUserListBinding, UserViewModel, UserIntent>() {
    
    override fun createBinding() = ActivityUserListBinding.inflate(layoutInflater)
    
    override fun getViewModelClass() = UserViewModel::class.java
    
    override fun initView() {
        // åˆå§‹åŒ–è§†å›¾
    }
    
    override fun observeData() {
        // è§‚å¯Ÿæ•°æ®çŠ¶æ€
        lifecycleScope.launch {
            repeatOnLifecycle(Lifecycle.State.STARTED) {
                viewModel.userState.collect { state ->
                    when (state) {
                        is UiState.Success -> {
                            binding.recyclerView.visible()
                            adapter.submitList(state.data)
                        }
                        else -> {
                            // ç©ºçŠ¶æ€å’Œé”™è¯¯çŠ¶æ€ç”± MviUiActivity è‡ªåŠ¨å¤„ç†
                            binding.recyclerView.gone()
                        }
                    }
                }
            }
        }
    }
    
    /**
     * è‡ªå®šä¹‰ç©ºçŠ¶æ€é…ç½®ï¼ˆå¯é€‰ï¼‰
     */
    override fun getEmptyStateConfig() = EmptyStateConfig(
        emptyMessage = "è¿˜æ²¡æœ‰ç”¨æˆ·å“¦~",
        errorMessage = "åŠ è½½å¤±è´¥äº†",
        loadingMessage = "åŠ è½½ä¸­..."
    )
}
```

#### è‡ªåŠ¨çŠ¶æ€ç®¡ç†
```kotlin
// ViewModel ä¸­é€šè¿‡ MviUiEvent è§¦å‘ç©ºçŠ¶æ€æ˜¾ç¤º
class UserViewModel : MviUiViewModel<UserIntent>() {
    
    private fun loadUsers() {
        viewModelScope.launch {
            try {
                val users = apiService.getUserList()
                if (users.isEmpty()) {
                    // âœ… è‡ªåŠ¨æ˜¾ç¤ºç©ºçŠ¶æ€
                    showEmptyState("è¿˜æ²¡æœ‰ç”¨æˆ·å“¦~")
                } else {
                    hideEmptyState()
                    _userState.value = UiState.Success(users)
                }
            } catch (e: Exception) {
                // âœ… è‡ªåŠ¨æ˜¾ç¤ºé”™è¯¯çŠ¶æ€
                showErrorState("åŠ è½½å¤±è´¥ï¼Œè¯·é‡è¯•") {
                    loadUsers()  // é‡è¯•å›è°ƒ
                }
            }
        }
    }
}
```

### 2. EmptyStateManagerï¼ˆç©ºçŠ¶æ€ç®¡ç†ï¼‰

#### ä½¿ç”¨æ–¹å¼
```kotlin
// âœ… åœ¨ ViewModel ä¸­ä½¿ç”¨
class UserViewModel : MviUiViewModel<UserIntent>() {
    
    private fun loadUsers() {
        viewModelScope.launch {
            try {
                val users = apiService.getUserList()
                if (users.isEmpty()) {
                    showEmptyState(
                        message = "è¿˜æ²¡æœ‰ç”¨æˆ·å“¦~",
                        onRetry = { loadUsers() }
                    )
                } else {
                    hideEmptyState()
                    _userState.value = UiState.Success(users)
                }
            } catch (e: Exception) {
                showErrorState(
                    message = "åŠ è½½å¤±è´¥ï¼Œè¯·é‡è¯•",
                    onRetry = { loadUsers() }
                )
            }
        }
    }
}
```

### 3. SkeletonManagerï¼ˆéª¨æ¶å±ç®¡ç†ï¼‰

#### ä½¿ç”¨æ–¹å¼
```kotlin
class UserListActivity : MviUiActivity<...>() {
    
    override fun initView() {
        // âœ… æ˜¾ç¤ºéª¨æ¶å±
        SkeletonManager.showSkeleton(binding.recyclerView)
        
        // åŠ è½½æ•°æ®
        sendIntent(UserIntent.LoadUsers)
    }
    
    override fun observeData() {
        lifecycleScope.launch {
            repeatOnLifecycle(Lifecycle.State.STARTED) {
                viewModel.userState.collect { state ->
                    when (state) {
                        is UiState.Success -> {
                            // âœ… éšè—éª¨æ¶å±
                            SkeletonManager.hideSkeleton()
                            adapter.submitList(state.data)
                        }
                        is UiState.Error -> {
                            // âœ… éšè—éª¨æ¶å±
                            SkeletonManager.hideSkeleton()
                        }
                        else -> {}
                    }
                }
            }
        }
    }
}
```

### 4. MviDialogï¼ˆå¯¹è¯æ¡†ï¼‰

#### ä½¿ç”¨æ–¹å¼
```kotlin
// âœ… æ˜¾ç¤ºé€šç”¨å¯¹è¯æ¡†
MviDialog.show(
    context = this,
    title = "æç¤º",
    message = "ç¡®å®šè¦åˆ é™¤å—ï¼Ÿ",
    confirmText = "ç¡®å®š",
    cancelText = "å–æ¶ˆ",
    onConfirm = {
        // ç¡®è®¤æ“ä½œ
        sendIntent(UserIntent.DeleteUser(userId))
    },
    onCancel = {
        // å–æ¶ˆæ“ä½œ
    }
)

// âœ… æ˜¾ç¤ºåŠ è½½å¯¹è¯æ¡†
MviDialog.showLoading(context = this, message = "åŠ è½½ä¸­...")

// âœ… éšè—åŠ è½½å¯¹è¯æ¡†
MviDialog.hideLoading()
```

### 5. CommonTitleBarï¼ˆé€šç”¨æ ‡é¢˜æ ï¼‰

#### ä½¿ç”¨æ–¹å¼
```xml
<!-- layout/activity_user_list.xml -->
<com.mvi.ui.widget.CommonTitleBar
    android:id="@+id/titleBar"
    android:layout_width="match_parent"
    android:layout_height="?attr/actionBarSize"
    app:title="ç”¨æˆ·åˆ—è¡¨"
    app:showBack="true"
    app:showMore="true" />
```

```kotlin
// âœ… åœ¨ Activity ä¸­ä½¿ç”¨
binding.titleBar.setOnBackClickListener {
    finish()
}

binding.titleBar.setOnMoreClickListener {
    // æ˜¾ç¤ºæ›´å¤šèœå•
}
```

## ğŸ“ å¸ƒå±€è§„èŒƒ

### 1. ViewBinding ä½¿ç”¨

#### åŸºç¡€è§„èŒƒ
```kotlin
// âœ… æ­£ç¡®ï¼šä½¿ç”¨ ViewBinding
class UserListActivity : MviActivity<ActivityUserListBinding, ...>() {
    
    override fun createBinding() = ActivityUserListBinding.inflate(layoutInflater)
    
    override fun initView() {
        binding.btnLoad.setOnClickListener {
            sendIntent(UserIntent.LoadUsers)
        }
    }
}
```

### 2. å¸ƒå±€å‘½åè§„èŒƒ

- âœ… **Activity å¸ƒå±€**ï¼š`activity_user_list.xml` â†’ `ActivityUserListBinding`
- âœ… **Fragment å¸ƒå±€**ï¼š`fragment_user_detail.xml` â†’ `FragmentUserDetailBinding`
- âœ… **Item å¸ƒå±€**ï¼š`item_user.xml` â†’ `ItemUserBinding`
- âœ… **Dialog å¸ƒå±€**ï¼š`dialog_confirm.xml` â†’ `DialogConfirmBinding`

### 3. å¸ƒå±€ç»„ç»‡

#### æ¨èç»“æ„
```xml
<!-- activity_user_list.xml -->
<androidx.constraintlayout.widget.ConstraintLayout>
    
    <!-- æ ‡é¢˜æ  -->
    <com.mvi.ui.widget.CommonTitleBar
        android:id="@+id/titleBar" />
    
    <!-- å†…å®¹åŒºåŸŸ -->
    <androidx.swiperefreshlayout.widget.SwipeRefreshLayout
        android:id="@+id/swipeRefresh">
        
        <androidx.recyclerview.widget.RecyclerView
            android:id="@+id/recyclerView" />
            
    </androidx.swiperefreshlayout.widget.SwipeRefreshLayout>
    
    <!-- ç©ºçŠ¶æ€ï¼ˆç”± EmptyStateManager ç®¡ç†ï¼‰ -->
    <include layout="@layout/mvi_empty_state_empty" />
    <include layout="@layout/mvi_empty_state_error" />
    <include layout="@layout/mvi_empty_state_loading" />
    
</androidx.constraintlayout.widget.ConstraintLayout>
```

## ğŸ¯ View æ‰©å±•å‡½æ•°

### 1. å¯è§æ€§æ‰©å±•

#### ä½¿ç”¨æ–¹å¼
```kotlin
import com.mvi.ui.ext.visible
import com.mvi.ui.ext.gone
import com.mvi.ui.ext.invisible

// âœ… æ˜¾ç¤ºè§†å›¾
binding.recyclerView.visible()

// âœ… éšè—è§†å›¾ï¼ˆä¸å ä½ï¼‰
binding.recyclerView.gone()

// âœ… éšè—è§†å›¾ï¼ˆå ä½ï¼‰
binding.recyclerView.invisible()
```

### 2. ç‚¹å‡»é˜²æŠ–

#### ä½¿ç”¨æ–¹å¼
```kotlin
// âœ… é˜²æ­¢é‡å¤ç‚¹å‡»ï¼ˆé»˜è®¤ 500msï¼‰
binding.btnSubmit.clickThrottle {
    sendIntent(UserIntent.Submit)
}

// âœ… è‡ªå®šä¹‰é˜²æŠ–æ—¶é—´
binding.btnSubmit.clickThrottle(1000) {
    sendIntent(UserIntent.Submit)
}
```

## ğŸ“± å±å¹•é€‚é…

### 1. AndroidAutoSize é…ç½®

#### Application ä¸­åˆå§‹åŒ–
```kotlin
class MyApplication : Application() {
    override fun onCreate() {
        super.onCreate()
        
        // âœ… å±å¹•é€‚é…åˆå§‹åŒ–
        AutoSizeConfig.getInstance()
            .setCustomFragment(true)
            .setLog(true)
    }
}
```

#### ä½¿ç”¨è§„èŒƒ
```xml
<!-- âœ… ä½¿ç”¨ dp å•ä½ï¼ˆè‡ªåŠ¨é€‚é…ï¼‰ -->
<TextView
    android:layout_width="100dp"
    android:layout_height="wrap_content"
    android:textSize="14sp" />

<!-- âŒ é¿å…ä½¿ç”¨ px å•ä½ -->
<TextView
    android:layout_width="100px" />  <!-- âŒ ç¦æ­¢ -->
```

## ğŸ¨ Material Design

### 1. Material ç»„ä»¶ä½¿ç”¨

#### æ¨èç»„ä»¶
```xml
<!-- âœ… ä½¿ç”¨ Material ç»„ä»¶ -->
<com.google.android.material.button.MaterialButton
    android:text="ç¡®è®¤"
    app:cornerRadius="8dp" />

<com.google.android.material.textfield.TextInputLayout
    android:hint="ç”¨æˆ·å">
    <com.google.android.material.textfield.TextInputEditText />
</com.google.android.material.textfield.TextInputLayout>
```

## ğŸ“ æœ€ä½³å®è·µ

### 1. èµ„æºæ–‡ä»¶ç»„ç»‡
```
res/
â”œâ”€â”€ values/
â”‚   â”œâ”€â”€ colors.xml          # é¢œè‰²å®šä¹‰
â”‚   â”œâ”€â”€ dimens.xml          # å°ºå¯¸å®šä¹‰
â”‚   â”œâ”€â”€ strings.xml         # å­—ç¬¦ä¸²å®šä¹‰ï¼ˆé»˜è®¤ï¼‰
â”‚   â””â”€â”€ styles.xml          # æ ·å¼å®šä¹‰
â”œâ”€â”€ values-zh/
â”‚   â””â”€â”€ strings.xml          # ä¸­æ–‡å­—ç¬¦ä¸²
â””â”€â”€ layout/
    â”œâ”€â”€ activity_*.xml      # Activity å¸ƒå±€
    â”œâ”€â”€ fragment_*.xml      # Fragment å¸ƒå±€
    â””â”€â”€ item_*.xml          # Item å¸ƒå±€
```

### 2. ç»„ä»¶å¤ç”¨
```kotlin
// âœ… æ­£ç¡®ï¼šåˆ›å»ºå¯å¤ç”¨çš„ç»„ä»¶
class UserItemView @JvmOverloads constructor(
    context: Context,
    attrs: AttributeSet? = null
) : ConstraintLayout(context, attrs) {
    
    private val binding = ItemUserBinding.inflate(LayoutInflater.from(context), this)
    
    fun bind(user: User) {
        binding.tvName.text = user.name
        binding.tvEmail.text = user.email
    }
}
```

### 3. çŠ¶æ€ç®¡ç†
```kotlin
// âœ… æ­£ç¡®ï¼šæ ¹æ®çŠ¶æ€æ›´æ–° UI
when (state) {
    is UiState.Loading -> {
        binding.progressBar.visible()
        binding.recyclerView.gone()
    }
    is UiState.Success -> {
        binding.progressBar.gone()
        binding.recyclerView.visible()
        adapter.submitList(state.data)
    }
    is UiState.Error -> {
        binding.progressBar.gone()
        binding.recyclerView.gone()
        // é”™è¯¯çŠ¶æ€ç”± MviUiActivity è‡ªåŠ¨å¤„ç†
    }
}
```

## ğŸš« ç¦æ­¢äº‹é¡¹

### 1. ç¡¬ç¼–ç èµ„æº
```kotlin
// âŒ é”™è¯¯ï¼šç¡¬ç¼–ç å­—ç¬¦ä¸²
binding.textView.text = "Hello World"

// âŒ é”™è¯¯ï¼šç¡¬ç¼–ç é¢œè‰²
binding.textView.setTextColor(0xFF212121.toInt())

// âŒ é”™è¯¯ï¼šç¡¬ç¼–ç å°ºå¯¸
binding.textView.textSize = 14f
```

### 2. ç›´æ¥ findViewById
```kotlin
// âŒ é”™è¯¯ï¼šä½¿ç”¨ findViewById
val textView = findViewById<TextView>(R.id.textView)

// âœ… æ­£ç¡®ï¼šä½¿ç”¨ ViewBinding
binding.textView.text = "Hello"
```

---

**æœ€åæ›´æ–°**: 2024-12-17  
**ç»´æŠ¤è€…**: aFramework Team
